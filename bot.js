const Discord = require('discord.js');
const client = new Discord.Client();
const ayarlar = require('./ayarlar.json');
const chalk = require('chalk');
const moment = require('moment');
var Jimp = require('jimp');
const { Client, Util } = require('discord.js');
const weather = require('weather-js')
const fs = require('fs');
const db = require('quick.db');
const http = require('http');
const express = require('express');
require('./util/eventLoader.js')(client);
const path = require('path');
const request = require('request');
const snekfetch = require('snekfetch');
const queue = new Map();
const YouTube = require('simple-youtube-api');
const ytdl = require('ytdl-core');

client.ayarlar={
  prefix : "!",
}
const app = express();
app.get("/", (request, response) => {
  console.log(Date.now() + " Ping tamamdÄ±r.");
  response.sendStatus(200);
});
app.listen(process.env.PORT);
setInterval(() => {
  http.get(`http://${process.env.PROJECT_DOMAIN}.glitch.me/`);
}, 280000);

var prefix = ayarlar.prefix;

const log = message => {
    console.log(`${message}`);
};

client.commands = new Discord.Collection();
client.aliases = new Discord.Collection();
fs.readdir('./komutlar/', (err, files) => {
    if (err) console.error(err);
    log(`${files.length} komut yÃ¼klenecek.`);
    files.forEach(f => {
        let props = require(`./komutlar/${f}`);
        log(`YÃ¼klenen komut: ${props.help.name}.`);
        client.commands.set(props.help.name, props);
        props.conf.aliases.forEach(alias => {
            client.aliases.set(alias, props.help.name);
        });
    });
});




client.reload = command => {
    return new Promise((resolve, reject) => {
        try {
            delete require.cache[require.resolve(`./komutlar/${command}`)];
            let cmd = require(`./komutlar/${command}`);
            client.commands.delete(command);
            client.aliases.forEach((cmd, alias) => {
                if (cmd === command) client.aliases.delete(alias);
            });
            client.commands.set(command, cmd);
            cmd.conf.aliases.forEach(alias => {
                client.aliases.set(alias, cmd.help.name);
            });
            resolve();
        } catch (e) {
            reject(e);
        }
    });
};

client.load = command => {
    return new Promise((resolve, reject) => {
        try {
            let cmd = require(`./komutlar/${command}`);
            client.commands.set(command, cmd);
            cmd.conf.aliases.forEach(alias => {
                client.aliases.set(alias, cmd.help.name);
            });
            resolve();
        } catch (e) {
            reject(e);
        }
    });
};




client.unload = command => {
    return new Promise((resolve, reject) => {
        try {
            delete require.cache[require.resolve(`./komutlar/${command}`)];
            let cmd = require(`./komutlar/${command}`);
            client.commands.delete(command);
            client.aliases.forEach((cmd, alias) => {
                if (cmd === command) client.aliases.delete(alias);
            });
            resolve();
        } catch (e) {
            reject(e);
        }
    });
};

client.elevation = message => {
    if (!message.guild) {
        return;
    }
    let permlvl = 0;
    if (message.member.hasPermission("BAN_MEMBERS")) permlvl = 2;
    if (message.member.hasPermission("ADMINISTRATOR")) permlvl = 3;
    if (message.author.id === ayarlar.sahip) permlvl = 4;
    return permlvl;
};

var regToken = /[\w\d]{24}\.[\w\d]{6}\.[\w\d-_]{27}/g;
// client.on('debug', e => {
//   console.log(chalk.bgBlue.green(e.replace(regToken, 'that was redacted')));
// });

client.on('warn', e => {
    console.log(chalk.bgYellow(e.replace(regToken, 'that was redacted')));
});

client.on('error', e => {
    console.log(chalk.bgRed(e.replace(regToken, 'that was redacted')));
});

client.login(ayarlar.token);




/////////////ototag



client.on("guildMemberAdd", async member => {
let kontrol = await db.fetch(`ototag_${member.guild.id}`)
if(!kontrol) return
if (member.bot === true) return;

 var sonuc = await db.fetch(`ototag_${member.guild.id}`).replace("-uye-", `${member.user.username}`) 
 member.setNickname(sonuc);
 

 })

/////////////reklam-kick

client.on("message", async message => {
    let uyarisayisi = await db.fetch(`reklamuyari_${message.author.id}`);
    let reklamkick = await db.fetch(`reklamkick_${message.guild.id}`)
    let kullanici = message.member;
    if (reklamkick == 'kapali') return;
    if (reklamkick == 'acik') {
        const reklam = ["discord.app", "discord.gg", "invite", "discordapp", "discordgg", ".com", ".net", ".xyz", ".tk", ".pw", ".io", ".me", ".gg", "www.", "https", "http", ".gl", ".org", ".com.tr", ".biz", ".party", ".rf.gd", ".az",];
        if (reklam.some(word => message.content.toLowerCase().includes(word))) {
            if (!message.member.hasPermission("ADMINISTRATOR")) {
                message.delete();
                db.add(`reklamuyari_${message.author.id}`, 1) //uyarÄ± puanÄ± ekleme
                if (uyarisayisi === null) {
                    let uyari = new Discord.RichEmbed()
                        .setColor("RANDOM")
                        .setFooter('Reklam kick sistemi', client.user.avatarURL)
                        .setDescription(`<@${message.author.id}> **reklam kick sistemine yakalandÄ±n! Reklam yapmaya devam edersen kickleniceksin (1/3)**`)
                        .setTimestamp()
                    message.channel.send(uyari)                
}
                if (uyarisayisi === 1) {
                    let uyari = new Discord.RichEmbed()
                        .setColor("RANDOM")
                        .setFooter('Reklam kick sistemi', client.user.avatarURL)
                        .setDescription(`<@${message.author.id}> **reklam kick sistemine yakalandÄ±n! Reklam yapmaya devam edersen kickleniceksin (2/3)**`)
                        .setTimestamp()
                    message.channel.send(uyari)
                }
                if (uyarisayisi === 2) {
                    message.delete();
                    await kullanici.kick({
                        reason: `Reklam kick sistemi`,
                    })
                    let uyari = new Discord.RichEmbed()
                        .setColor("RANDOM")
                        .setFooter('Reklam kick sistemi', client.user.avatarURL)
                        .setDescription(`<@${message.author.id}> **3 adet reklam uyarÄ±sÄ± aldÄ±ÄŸÄ± iÃ§in kicklendi. Bir kez daha yaparsa banlanacak**`)
                        .setTimestamp()
                    message.channel.send(uyari)
                }
                if (uyarisayisi === 3) {
                    message.delete();
                    await kullanici.ban({
                        reason: `Reklam ban sistemi`,
                    })
                    db.delete(`reklamuyari_${message.author.id}`)
                    let uyari = new Discord.RichEmbed()
                        .setColor("RANDOM")
                        .setFooter('Reklam kick sistemi', client.user.avatarURL)
                        .setDescription(`<@${message.author.id}> **kick yedikten sonra tekrar devam ettiÄŸi iÃ§in banlandÄ±.**`)
                        .setTimestamp()
                    message.channel.send(uyari)
                }
            }
        }
    }
});

////////////otorol


client.on("guildMemberAdd", async member => {
let kanal = await db.fetch(`otok_${member.guild.id}`)  
let rol = await db.fetch(`otorol_${member.guild.id}`)   
let mesaj =  db.fetch(`otomesaj_${member.guild.id}`)  
if(!kanal) return

if(!mesaj) {
  
  client.channels.get(kanal).send(':loudspeaker: :inbox_tray: Otomatik Rol Verildi Seninle Beraber `'+member.guild.memberCount+'` KiÅŸiyiz! HoÅŸgeldin! `'+member.user.username+'`')
member.addRole(rol)
  return
}

if(mesaj) {
  var mesajs = await db.fetch(`otomesaj_${member.guild.id}`).replace("-uye-", `${member.user.tag}`).replace("-rol-", `${member.guild.roles.get(rol).name}`).replace("-server-", `${member.guild.name}`).replace("-uyesayisi-", `${member.guild.memberCount}`).replace("-botsayisi-", `${member.guild.members.filter(m => m.user.bot).size}`).replace("-bolge-", `${member.guild.region}`).replace("-kanalsayisi-", `${member.guild.channels.size}`)
  member.addRole(rol)
  client.channels.get(kanal).send(mesajs)


}  
  
});
//////////////kufurengel


let kufurEngel = JSON.parse(fs.readFileSync("./jsonlar/kufurEngelle.json", "utf8"));
client.on("message", msg => {
  if (!msg.guild) return;
  if (!kufurEngel[msg.guild.id]) return;
  if (kufurEngel[msg.guild.id].kÃ¼fÃ¼rEngel === 'kapali') return;
    if (kufurEngel[msg.guild.id].kÃ¼fÃ¼rEngel=== 'acik') {
      const kufur = ["mk", "amk", "aq", "orospu", "oruspu", "oÃ§", "sikerim", "yarrak", "piÃ§", "amq", "sik", "amcÄ±k", "Ã§ocu", "sex", "seks", "amÄ±na", "orospu Ã§ocuÄŸu", "sg", "siktir git"];
  if (kufur.some(word => msg.content.toLowerCase().includes(word)) ) {
    if (!msg.member.hasPermission("ADMINISTRATOR")) {
      msg.delete()
       msg.reply("Bu sunucuda kÃ¼fÃ¼rler **LordGriffin** tarafÄ±ndan engellenmektedir! KÃ¼fÃ¼r etmene izin vermeyeceÄŸim!").then(message => message.delete(3000));
    }
}
    }
});





////////////sa-as emoji


client.on('message', async msg => {
  if (msg.content.toLowerCase() === 'sa') {
    await msg.react('ðŸ‡¦');
    msg.react('ðŸ‡¸');
  }
  });

////////////////hgbb
client.on("guildMemberAdd", async member => {
   const fs = require('fs');
    let gkanal = JSON.parse(fs.readFileSync("./ayarlar/glog.json", "utf8"));
    const gÃ¶zelkanal = member.guild.channels.get(gkanal[member.guild.id].resim)
    if (!gÃ¶zelkanal) return;
     let username = member.user.username;
        if (gÃ¶zelkanal === undefined || gÃ¶zelkanal === null) return;
        if (gÃ¶zelkanal.type === "text") {
            const bg = await Jimp.read("https://cdn.discordapp.com/attachments/450693709076365323/473184528148725780/guildAdd.png");
            const userimg = await Jimp.read(member.user.avatarURL);
            var font;
            if (member.user.tag.length < 15) font = await Jimp.loadFont(Jimp.FONT_SANS_128_WHITE);
            else if (member.user.tag.length > 15) font = await Jimp.loadFont(Jimp.FONT_SANS_64_WHITE);
            else font = await Jimp.loadFont(Jimp.FONT_SANS_32_WHITE);
            await bg.print(font, 430, 170, member.user.tag);
            await userimg.resize(362, 362);
            await bg.composite(userimg, 43, 26).write("./img/"+ member.id + ".png");
              setTimeout(function () {
                    gÃ¶zelkanal.send(new Discord.Attachment("./img/" + member.id + ".png"));
              }, 1000);
              setTimeout(function () {
                fs.unlink("./img/" + member.id + ".png");
              }, 10000);
        }
    })

client.on("guildMemberRemove", async member => {
   const fs = require('fs');
    let gkanal = JSON.parse(fs.readFileSync("./ayarlar/glog.json", "utf8"));
    const gÃ¶zelkanal = member.guild.channels.get(gkanal[member.guild.id].resim)
    if (!gÃ¶zelkanal) return;
        let username = member.user.username;
        if (gÃ¶zelkanal === undefined || gÃ¶zelkanal === null) return;
        if (gÃ¶zelkanal.type === "text") {            
                        const bg = await Jimp.read("https://cdn.discordapp.com/attachments/450693709076365323/473184546477572107/guildRemove.png");
            const userimg = await Jimp.read(member.user.avatarURL);
            var font;
            if (member.user.tag.length < 15) font = await Jimp.loadFont(Jimp.FONT_SANS_128_WHITE);
            else if (member.user.tag.length > 15) font = await Jimp.loadFont(Jimp.FONT_SANS_64_WHITE);
            else font = await Jimp.loadFont(Jimp.FONT_SANS_32_WHITE);
            await bg.print(font, 430, 170, member.user.tag);
            await userimg.resize(362, 362);
            await bg.composite(userimg, 43, 26).write("./img/"+ member.id + ".png");
              setTimeout(function () {
                    gÃ¶zelkanal.send(new Discord.Attachment("./img/" + member.id + ".png"));
              }, 1000);
              setTimeout(function () {
                fs.unlink("./img/" + member.id + ".png");
              }, 10000);
        }
    })

/////////////////neselendir

client.on('message', msg => {
  if (msg.content.toLowerCase() === 'blm') {
    msg.channel.sendMessage('Senin bilmediÄŸini biz nasÄ±l bilek');
  }
});

client.on('message', msg => {
  if (msg.content.toLowerCase() === 'bilmm') {
    msg.channel.sendMessage('Senin bilmediÄŸini biz nasÄ±l bilek');
  }
});


client.on('message', msg => {
  if (msg.content.toLowerCase() === 'hmm') {
    msg.channel.sendMessage('Ne dÃ¼ÅŸÃ¼nÃ¼on acaba :thinking: ');
  }
});

client.on('message', msg => {
  if (msg.content.toLowerCase() === 'nasÄ±lsÄ±nÄ±z') {
    msg.channel.sendMessage('Ä°yi knk Sen NasÄ±lsÄ±n');
  }
});

client.on('message', msg => {
  if (msg.content.toLowerCase() === 'knk') {
    msg.channel.sendMessage('Efendim knk');
  }
});


client.on('message', msg => {
  if (msg.content.toLowerCase() === 'aq') {
    msg.channel.sendMessage('KÃ¼fÃ¼r Etme Lan  :thinking: ');
  }
});


client.on('message', msg => {
  if (msg.content.toLowerCase() === 'of') {
    msg.channel.sendMessage('SÄ±kÄ±ldÄ±nmÄ± :thinking: ');
  }
});

client.on('message', msg => {
  if (msg.content.toLowerCase() === 'bilmem') {
    msg.channel.sendMessage('Senin bilmediÄŸini biz nasÄ±l bilek');
  }
});

client.on('message', msg => {
  if (msg.content.toLowerCase() === 'bilmm') {
    msg.channel.sendMessage('Senin bilmediÄŸini biz nasÄ±l bilek');
  }
});


/////////////kayit-sistemi
client.on("guildMemberAdd", async member => {
 let mesaj = await db.fetch(`mesaj_${member.guild.id}`)
let kanal = await db.fetch(`kanal_${member.guild.id}`) 
if(!kanal) return
if(!mesaj) {
client.channels.get(kanal).send(':scroll: '+member.user.tag+' Selam Ã‡ok Az KaldÄ± KaydÄ±nÄ± Tamamla Ve Bizimle Sohbete EriÅŸ! `$KayÄ±t isim YaÅŸ`')  
  
}
if(mesaj) {
 var mesajs = await db.fetch(`mesaj_${member.guild.id}`).replace("-uye-", `${member.user.tag}`).replace("-uyetag-", `${member.user.username}`) 
 client.channels.get(kanal).send(mesajs) 

}
});
///////////////////ozel hg 



client.on('guildMemberAdd', async member => {
  let ozelhosgeldin = await db.fetch(`ozelhosgeldin_${member.guild.id}`)
  if (!ozelhosgeldin) return;
  member.send(ozelhosgeldin ? ozelhosgeldin.replace('-sunucu-', `\`${member.guild.name}\``) .replace('-kullanÄ±cÄ±-',`\`${member.user.tag}\``) : ``)
})

/////////////////sunucukur


client.on('message', async message => {
  const ms = require('ms');
  const args = message.content.slice(ayarlar.prefix.length).trim().split(/ +/g);
  const command = args.shift().toLowerCase();
  let u = message.mentions.users.first() || message.author;
  if (command === "sunucukur") {
  if (message.guild.channels.find(channel => channel.name === "Bot KullanÄ±mÄ±")) return message.channel.send(" Bot Paneli Zaten AyarlanmÄ±ÅŸ.")
  if (!message.member.hasPermission('ADMINISTRATOR'))
  return message.channel.send(" Bu Kodu `YÃ¶netici` Yetkisi Olan KiÅŸi Kullanabilir.");
    message.channel.send(`Bot Bilgi KanallarÄ±nÄ±n kurulumu baÅŸlatÄ±lsÄ±n mÄ±? baÅŸlatÄ±lacak ise **evet** yazÄ±nÄ±z.`)
      message.channel.awaitMessages(response => response.content === 'evet', {
        max: 1,
        time: 10000,
        errors: ['time'],
      })
    .then((collected) => {
   message.guild.createChannel('|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|', 'category', [{
  id: message.guild.id,
  deny: ['SEND_MESSAGES']
}])



        
 message.guild.createChannel('ã€ŒðŸ“ƒã€kurallar', 'text', [{
  id: message.guild.id,
  deny: ['SEND_MESSAGES']
}])
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));
 message.guild.createChannel('ã€ŒðŸšªã€gelen-giden', 'text', [{
  id: message.guild.id,
  deny: ['SEND_MESSAGES']
}])
.then(channel =>
       channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));
       message.guild.createChannel('ã€Œâœ…ã€sayaÃ§', 'text', [{
        id: message.guild.id,
        deny: ['SEND_MESSAGES']
      }])
.then(channel =>
             channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));
             message.guild.createChannel('ã€ŒðŸ’¾ã€log-kanalÄ±', 'text', [{
              id: message.guild.id,
              deny: ['SEND_MESSAGES']
            }])
            .then(channel => channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));
            message.guild.createChannel('ã€ŒðŸ“¢ã€duyuru-odasÄ±', 'text', [{
              id: message.guild.id,
              deny: ['SEND_MESSAGES']
            }])
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|Ã–NEMLÄ° KANALLAR|â–¬â–¬|")));

       }) 
       .then((collected) => {
        message.guild.createChannel('|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|', 'category', [{
       id: message.guild.id,
     }]);
             
      message.guild.createChannel(`ã€ŒðŸ’¡ã€ÅŸikayet-ve-Ã¶neri`, 'text')
     .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|")));
     message.guild.createChannel(`ã€ŒðŸ‘¥ã€pre-arama-odasÄ±`, 'text')
     .then(channel =>
            channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|")));
     message.guild.createChannel(`ã€ŒðŸ“·ã€gÃ¶rsel-iÃ§erik`, 'text')
     .then(channel =>
                  channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|")));
     message.guild.createChannel(`ã€ŒðŸ¤–ã€bot-komutlarÄ±`, 'text')
     .then(channel =>
                  channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|")));
     message.guild.createChannel(`ã€ŒðŸ’¬ã€sohbet`, 'text')
     .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|GENEL KANALLAR|â–¬â–¬|")));

      message.guild.createChannel(`ðŸ†ã€‹Kurucu OdasÄ±`, "voice")
      .then(channel =>
        channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|SES KANALLARI|â–¬â–¬|")))
      .then(c => {
        let role = message.guild.roles.find("name", "@everyone");
        let role2 = message.guild.roles.find("name", "Kurucu");
        
        c.overwritePermissions(role, {
            CONNECT: false,
        });
        c.overwritePermissions(role2, {
            CONNECT: true,
            
        });
    })

    message.guild.createChannel('|â–¬â–¬|SES KANALLARI|â–¬â–¬|', 'category', [{
      id: message.guild.id,
    }]);

    message.guild.createChannel(`ðŸ†ã€‹YÃ¶netici OdasÄ±`, "voice")
    .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|SES KANALLARI|â–¬â–¬|")))
    .then(c => {
      let role = message.guild.roles.find("name", "@everyone");
      let role2 = message.guild.roles.find("name", "Kurucu");
      let role3 = message.guild.roles.find("name", "YÃ¶netici");
      c.overwritePermissions(role, {
          CONNECT: false,
      });
      c.overwritePermissions(role2, {
          CONNECT: true,
      });
      c.overwritePermissions(role3, {
          CONNECT: true,
      });
  })

  message.guild.createChannel(`ðŸ’¬ã€‹Sohbet OdasÄ±`, "voice")
  .then(channel =>
    channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|SES KANALLARI|â–¬â–¬|")))
  .then(c => {
    let role = message.guild.roles.find("name", "@everyone");
    c.overwritePermissions(role, {
        CONNECT: true,
    });
})

message.guild.createChannel('|â–¬â–¬|OYUN ODALARI|â–¬â–¬|', 'category', [{
  id: message.guild.id,
}]);

message.guild.createChannel(`ðŸŽ®ã€‹LOL`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
 message.guild.createChannel(`ðŸŽ®ã€‹ZULA`, 'voice')
 .then(channel =>
  channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
 message.guild.createChannel(`ðŸŽ®ã€‹COUNTER STRÄ°KE`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
 message.guild.createChannel(`ðŸŽ®ã€‹PUBG`, 'voice')
 .then(channel =>
  channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
  message.guild.createChannel(`ðŸŽ®ã€‹FORTNÄ°TE`, 'voice')
  .then(channel =>
   channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
   message.guild.createChannel(`ðŸŽ®ã€‹MÄ°NECRAFT`, 'voice')
   .then(channel =>
    channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
    message.guild.createChannel(`ðŸŽ®ã€‹ROBLOX`, 'voice')
    .then(channel =>
     channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))
     message.guild.createChannel(`ðŸŽ®ã€‹WOLFTEAM`, 'voice')
     .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|â–¬â–¬|OYUN ODALARI|â–¬â–¬|")))



      message.guild.createRole({
        name: 'Kurucu',
        color: 'RED',
        permissions: [
            "ADMINISTRATOR",
    ]
      })

      
      message.guild.createRole({
        name: 'YÃ¶netici',
        color: 'BLUE',
        permissions: [
            "MANAGE_GUILD",
            "MANAGE_ROLES",
            "MUTE_MEMBERS",
            "DEAFEN_MEMBERS",
            "MANAGE_MESSAGES",
            "MANAGE_NICKNAMES",
            "KICK_MEMBERS"
    ]
      })

      message.guild.createRole({
        name: 'ModeratÃ¶r',
        color: 'GREEN',
        permissions: [
            "MANAGE_GUILD",
            "MANAGE_ROLES",
            "MUTE_MEMBERS",
            "DEAFEN_MEMBERS",
            "MANAGE_MESSAGES",
            "MANAGE_NICKNAMES"
    ]
      })

      message.guild.createRole({
        name: 'V.I.P',
        color: '00ffff',
      })

      message.guild.createRole({
        name: 'Ãœye',
        color: 'WHITE',
      })

      message.guild.createRole({
        name: 'Bot',
        color: 'ORANGE',
      })

       message.channel.send("Gerekli Odalar Kuruldu!")
     
            })   
    
}
});


//////////////////////////
const youTube = require('simple-youtube-api');
const Ytdl = require('ytdl-core');
const youtube = new YouTube('AIzaSyD3VpFtkSKqPyhNui-CmMqnGV91AtBFU9U');
const Queue = new Map();
var prefix = ayarlar.prefix;

client.on("message", async message => {
  var args = message.content.substring(prefix.length).split(" ");
    if (!message.content.startsWith(prefix)) return;
  var searchString = args.slice(1).join(' ');
  var url = args[1] ? args[1].replace(/<(.+)>/g, '$1') : '';
  var serverQueue = queue.get(message.guild.id);
    switch (args[0].toLowerCase()) {
        
      case "oynat":
    var voiceChannel = message.member.voiceChannel;
        
    const embed = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setDescription("ðŸŒDinlemek istediÄŸin ÅŸarkÄ±yÄ± yazmalÄ±sÄ±n! (ÅžarkÄ± ismi veya Youtube URLsi)")
    if (!url) return message.channel.send(embed);
        
    const voiceChannelAdd = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setDescription(`LÃ¼tfen herhangi bir sesli kanala katÄ±lÄ±nÄ±z.`)
    if (!voiceChannel) return message.channel.send(voiceChannelAdd);
    var permissions = voiceChannel.permissionsFor(message.client.user);
    if (!permissions.has('CONNECT')) {
      const warningErr = new Discord.RichEmbed()
      .setColor("RANDOM")
      .setDescription(`Herhangi bir sesli kanala katÄ±labilmek iÃ§in yeterli iznim yok.`)
      return message.channel.send(warningErr);
    }
    if (!permissions.has('SPEAK')) {
      const musicErr = new Discord.RichEmbed()
      .setColor("RANDOM")
      .setDescription(`MÃ¼zik aÃ§amÄ±yorum/ÅŸarkÄ± Ã§alamÄ±yorum Ã§Ã¼nkÃ¼ kanalda konuÅŸma iznim yok veya mikrofonum kapalÄ±.`)
      return message.channel.send(musicErr);
    }
      if (url.match(/^https?:\/\/(www.youtube.com|youtube.com)\/playlist(.*)$/)) {
      var playlist = await youtube.getPlaylist(url);
      var videos = await playlist.getVideos();
      for (const video of Object.values(videos)) {
        var video2 = await youtube.getVideoByID(video.id);
        await handleVideo(video2, message, voiceChannel, true);
      }
      const PlayingListAdd = new Discord.RichEmbed()
      .setColor("RANDOM")
      .setDescription(`[${playlist.title}](https://www.youtube.com/watch?v=${playlist.id}) Ä°simli ÅŸarkÄ± oynatma listesine Eklendi.`)
      return message.channel.send(PlayingListAdd);
    } else {
      try {
        var video = await youtube.getVideo(url);
      } catch (error) {
      try {
          var videos = await youtube.searchVideos(searchString, 10);
          
          var r = 1
        
          var video = await youtube.getVideoByID(videos[r - 1].id);
        } catch (err) {
          console.error(err);
          const songNope = new Discord.RichEmbed()
          .setColor("RANDOM")
          .setDescription(`AradÄ±ÄŸÄ±nÄ±z isimde bir ÅŸarkÄ± bulamadÄ±m.`) 
          return message.channel.send(songNope);
        }
      }
      return handleVideo(video, message, voiceChannel);
    }
    break
       case "tekrar":
       const e = new Discord.RichEmbed()
      .setColor("RANDOM")
      .setDescription(`Bir sesli kanalda deÄŸilsin.`) 
    if (!message.member.voiceChannel) return message.channel.send(e);
    const p = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setDescription(`Åžuanda herhangi bir ÅŸarkÄ± Ã§almÄ±yor.`)
    if (!serverQueue) return message.channel.send(p);
        
    var u = serverQueue.songs[0]
        
    /*var pla = await youtube.getPlaylist(u);
      var v = await pla.getVideos();*/
      var vi2 = await youtube.getVideoByID(u.id);
      await handleVideo(vi2, message, voiceChannel, true);
    const PlayingListAdd = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setDescription(`[${u.title}](https://www.youtube.com/watch?v=${u.id}) Ä°simli ÅŸarkÄ± bitince tekrar oynatÄ±lacak.`)
    return message.channel.send(PlayingListAdd);        
    break;
      case "geÃ§":
      const err0 = new Discord.RichEmbed()
      .setColor("RANDOM")
      .setTitle(`Hata`)
      .setDescription(`Bir sesli kanalda deÄŸilsin.`) 
    if (!message.member.voiceChannel) return message.channel.send(err0);
    const err05 = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`Hata`)
    .setDescription(`Åžuanda herhangi bir ÅŸarkÄ± Ã§almÄ±yor.`)
    if (!serverQueue) return message.channel.send(err05);
    const songSkip = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`ÅžarkÄ± GeÃ§ildi`)
    .setDescription(`ÅžarkÄ± baÅŸarÄ±yla geÃ§ildi. :thumbsup:  `)
    serverQueue.connection.dispatcher.end('g');
    message.channel.send(songSkip)
    return undefined;
break;
      case "kapat":
    const err1 = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`Hata`)
    .setDescription(`Bir sesli kanalda deÄŸilsin.`)  
    if (!message.member.voiceChannel) return message.channel.send(err1);
    const err2 = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`Hata`)
    .setDescription(`Åžuanda herhangi bir ÅŸarkÄ± Ã§almÄ±yor.`)
    if (!serverQueue) return message.channel.send(err2);
    serverQueue.songs = [];
    const songEnd = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`ÅžarkÄ± KapatÄ±ldÄ± :thumbsup: `)
    .setDescription(`ÅžarkÄ± baÅŸarÄ±yla durduruldu.`)
    serverQueue.connection.dispatcher.end('d');
    message.channel.send(songEnd)
    return undefined;
break;
      case "ses":
      const asd1 = new Discord.RichEmbed()
      .setColor("RANDOM")
      .setTitle(`Hata`)
      .setDescription(`Bir sesli kanalda deÄŸilsin.`)  
    if (!message.member.voiceChannel) return message.channel.send(asd1);
    const asd2 = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`Hata`)
    .setDescription(`Åžuanda herhangi bir ÅŸarkÄ± Ã§almÄ±yor.`)
    if (!serverQueue) return message.channel.send(asd2);
    
    let number = ["1","2","3","4","5", "6", "7", "8", "9", "10"]
    const yaziolmazamk = new Discord.RichEmbed ()
    .setColor ("RANDOM")
    .setTitle ('HATA')
    .setDescription('Ses Seviyesi SayÄ± olmalÄ±dÄ±r')
  //  if (!args[1] === number) return message.channel.send (yaziolmazamk)
    const volumeLevel = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`Ses Seviyesi`)
    .setDescription(`Åžuanki Ses Seviyesi: **${serverQueue.volume}**`)
    if(!args [1] === number) return;
    if (!args[1]) return message.channel.send(volumeLevel);
    serverQueue.volume = args[1];
    if (args[1] > 10) return message.channel.send(`Ses seviyesi en fazla \`10\` olarak ayarlanabilir.`)
    serverQueue.connection.dispatcher.setVolumeLogarithmic(args[1] / 10);
    const volumeLevelEdit = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`Ses Seviyesi`)
    .setDescription(`Ayarlanan Ses Seviyesi: **${args[1]}** :thumbsup: `)
    return message.channel.send(volumeLevelEdit);  
break;
      case "oynatÄ±lan":
    if (!serverQueue) return message.channel.send('HiÃ§birÅŸey Ã‡almÄ±yor');
        return message.channel.send(`:stopwatch: Åžu Anda OynatÄ±lan: **${serverQueue.songs[0].title}**`);
break;
      case "kuyruk":
      var siralama = 0;
    if (!serverQueue) return message.channel.send('Åžuanda herhangi bir ÅŸarkÄ± Ã§almÄ±yor.');
    const songList10 = new Discord.RichEmbed()
    .setColor("RANDOM")
    .addField(`:hourglass_flowing_sand: | Åžuanda OynatÄ±lan`, `${serverQueue.songs[0].title}`)
    .addField(`:alarm_clock: | ÅžarkÄ± KuyruÄŸu`, `${serverQueue.songs.map(song => `**-** ${song.title}`).join('\n')}`)
    return message.channel.send(songList10);
break;
case "duraklat":
      if (serverQueue && serverQueue.playing) {
        serverQueue.playing = false;
        serverQueue.connection.dispatcher.pause();
        const asjdhsaasjdha = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`ÅžarkÄ± DuraklatÄ±ldÄ±`)
    .setDescription(`ÅžarkÄ± baÅŸarÄ±yla duraklatÄ±ldÄ±.`)
      return message.channel.send(asjdhsaasjdha);
    }
    return message.channel.send('Åžuanda herhangi bir ÅŸarkÄ± Ã§almÄ±yor.');
break;
      case "devamet":
      if (serverQueue && !serverQueue.playing) {
        serverQueue.playing = true;
        serverQueue.connection.dispatcher.resume();
        const asjdhsaasjdhaadssad = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`ÅžarkÄ± Devam Ettiriliyor :thumbsup: `)
    .setDescription(`ÅžarkÄ± baÅŸarÄ±yla devam ettiriliyor...`)
      return message.channel.send(asjdhsaasjdhaadssad);
    }
    return message.channel.send('Åžuanda herhangi bir ÅŸarkÄ± Ã§almÄ±yor.');
  
  return undefined;
break;
}
async function handleVideo(video, message, voiceChannel, playlist = false) {
  var serverQueue = queue.get(message.guild.id);
  //console.log(video);
  var song = {
    id: video.id,
    title: video.title,
    url: `https://www.youtube.com/watch?v=${video.id}`,
    thumbnail: `https://img.youtube.com/vi/${video.id}/maxresdefault.jpg`,
    requester: message.author.id,
  };
  if (!serverQueue) {
    var queueConstruct = {
      textChannel: message.channel,
      voiceChannel: voiceChannel,
      connection: null,
      songs: [],
      volume: 5,
      playing: true
    };
    queue.set(message.guild.id, queueConstruct);
    queueConstruct.songs.push(song);
    try {
      var connection = await voiceChannel.join();
      queueConstruct.connection = connection;
      play(message.guild, queueConstruct.songs[0]);
    } catch (error) {
      console.error(`Ses kanalÄ±na giremedim HATA: ${error}`);
      queue.delete(message.guild.id);
      return message.channel.send(`Ses kanalÄ±na giremedim HATA: ${error}`);
    }
  } else {
    serverQueue.songs.push(song);
    //console.log(serverQueue.songs);
    if (playlist) return undefined;
    const songListBed = new Discord.RichEmbed()
    .setColor("RANDOM")
    .setTitle(`KuyruÄŸa Eklendi`)
    .setDescription(`**${song.title}** adlÄ± ÅŸarkÄ± kuyruÄŸa eklendi. :thumbsup: `)
    return message.channel.send(songListBed);
  }
  return undefined;
}
  function play(guild, song) {
  var serverQueue = queue.get(guild.id);
  if (!song) {
    serverQueue.voiceChannel.leave();
    queue.delete(guild.id);
    return;
  }
  //console.log(serverQueue.songs);
  const dispatcher = serverQueue.connection.playStream(ytdl(song.url))
    .on('end', reason => {
      /*if (reason === 'Ä°nternetten kaynaklÄ± bir sorun yÃ¼zÃ¼nden ÅŸarkÄ±lar kapatÄ±ldÄ±.');
      else console.log(reason);*/
      serverQueue.songs.shift();
      play(guild, serverQueue.songs[0]);
    })
    .on('error', error => console.error(error));
  dispatcher.setVolumeLogarithmic(serverQueue.volume / 5);
    
  const playingBed = new Discord.RichEmbed()
  .setColor("RANDOM")
  .setTitle("**AngelBot | MÃ¼zik**",`https://i.postimg.cc/BnQCzh2s/861acd45b3d34f97265ac7161fbb6763.png`)
  .setAuthor(`Åžuanda OynatÄ±lÄ±yor`, "https://davidjhinson.files.wordpress.com/2015/05/youtube-icon.png")
  .setDescription(`[${song.title}](${song.url})`)
  .addField("ÅžarkÄ± SÃ¼resi", `${song.durationm}: ${song.durations}`, true)
  .addField("ÅžarkÄ±yÄ± AÃ§an KullanÄ±cÄ±", `<@${song.requester}>`, true)
  .setThumbnail(song.thumbnail)
  serverQueue.textChannel.send(playingBed);
}
});

////
client.on('guildMemberAdd', async member => {
  if (db.has(`otorol_${member.guild.id}.rol`) === false) return;
  let otorol = await db.fetch(`otorol_${member.guild.id}.rol`)
  let kanal = await db.fetch(`otorol_${member.guild.id}.kanal`)
  
  member.addRole(otorol)
  member.guild.channels.get(kanal).send(` \`${member.user.tag}\` adlÄ± kullanÄ±cÄ±ya \`${member.guild.roles.get(otorol).name}\` adlÄ± rol **verildi!**`)
  })
// hgbb


